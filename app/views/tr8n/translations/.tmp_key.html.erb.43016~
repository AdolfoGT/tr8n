<%= render :partial => "/tr8n/common/header" %>
<%= render :partial => "breadcrumb" %>
<%= render :partial => "header" %>

<div class="section_box" style="margin-bottom:10px; background-color:#EFF8FF;">
  <% form_tag({:action => :key}, {:method => :get, :id => "translations_search_form"}) do %>
     <%=hidden_field_tag(:section_key, @section_key) %>
     <%=hidden_field_tag(:translation_key_id, @translation_key.id) %>
     <table>
      <tr>
        <td><%=text_field_tag(:search, params[:search], {:style => "width:800px;height:20px;font-size:14px;"})%></td>
        <td>
          <button type="submit" class="translator_btn translator_small_btn" onClick="$('translations_search_form').submit(); return false;">
              <span><%=trl("Search")%></span>
          </button>
        </td>
      </tr>
      <tr>
        <td>
          <%=trl("Show translations submitted by")%>
          <%=select_tag(:submitted_by, options_for_select([["anyone", "anyone"], ["me", "me"]], params[:submitted_by]))%>
          <%=trl("created on")%>
          <%=select_tag(:submitted_on, options_for_select([["any date", "any"], ["today", "today"], ["yesterday", "yesterday"], ["in the last week", "last_week"]], params[:submitted_on]))%>
        </td>
      </tr>
     </table>
  <% end %>
</div>

<div class="section_box">
	<div style="padding-top:10px;padding-bottom:10px;">
	  <table style="width:100%;">
	    <tr>
	      <td align='left'><%= will_paginate(@translations, :skip_decorations => true) %></td>
	      <td align='right'><%= page_entries_info(@translations, :skip_decorations => true, :entry_name => "translation") %></td>
	    </tr>
	  </table>
	</div>
	
  <table style="width:100%;" cellpadding="5px" cellspacing="3px">
    <tr style="border-bottom:1px solid #ccc;">
      <td style="width:25px; color:grey; font-size:14px; padding:5px; font-weight:bold;"><%=trl("Rank")%></td>
      <td style="width:80px; color:grey; font-size:14px; padding:5px; font-weight:bold;"><%=trl("Your Vote")%></td>
      <td style="color:grey; font-size:14px; padding:5px; font-weight:bold;"><%=trl("Translation")%></td>
			<td>&nbsp;</td>
    </tr>  
  
    <% @translations.each do |trn| %>
      <% style = "border-bottom:1px dotted #ccc;" unless @translations.last == trn %>
      <tr style="<%=style%>" id="translation_row_<%=trn.id%>">
        <%= render :partial => "translation", :locals => {:translation => trn, :mode => :view} %>
      </tr>
    <% end %>
  </table>
</div>
<% unless @translation_key.locked? %>
  <div style="font-size: 12px; color: grey; padding-top:20px; padding-bottom:15px;">
  <%=trl("You can only edit or delete translations submitted by you. If you don't like any of the translations for this phrase, {add_your_own_link}.", "",
        :add_your_own_link => link_to(trl("add your own translation"), :action => :view, :translation_key_id => @translation_key.id, :section_key => @section_key)) %> 
  </div>
<% end %>

<% unless @section_key %>
  <div style="padding-bottom:25px;text-align:center">
      <button type="submit" class="translator_btn translator_submit_btn" onClick=" location = '/tr8n/translations'; return false;">
          <span><%=trl("Back to Translations")%></span>
      </button>
  </div>
<% end %>

<script>
  function editTranslationRow(translation_id, section_key) {
    $('votes_for_' + translation_id).hide();
    $('spinner_for_' + translation_id).show();
    location = "/tr8n/translations/view?translation_id=" + translation_id + "&section_key=" + section_key;
  }
  
  function deleteTranslationRow(translation_id, section_key) {
    if (!confirm("<%=trl('Are you sure you want to delete this translation?')%>")) {
      return;
    }
    
    $('votes_for_' + translation_id).hide();
    $('spinner_for_' + translation_id).show();
    location = "/tr8n/translations/delete?translation_id=" + translation_id + "&section_key=" + section_key;
  }
  
  function updateTranslationRow(translation_id, mode) {
    $('votes_for_' + translation_id).hide();
    $('spinner_for_' + translation_id).show();
    
    new Ajax.Updater('translation_row_' + translation_id, '/tr8n/translations/update', {
      parameters: {translation_id:translation_id, mode:mode},
      evalScripts: true,
      method: 'get'
    });
  }
  
  function submitTranslationRow(translation_id) {
    $('votes_for_' + translation_id).hide();
    $('spinner_for_' + translation_id).show();
    
    new Ajax.Updater('translation_row_' + translation_id, '/tr8n/translations/update', {
      parameters: {translation_id:translation_id, label:$("translation_row_value_" + translation_id).value},
      evalScripts: true,
      method: 'post'
    });
  }
</script>

<%= render :partial => "/tr8n/common/footer" %>
