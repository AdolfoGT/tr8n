<%= render :partial => "/tr8n/common/header" %>
<%= render :partial => "breadcrumb" %>
<%= render :partial => "header" %>

<div id="tranlsations_list">
	<div class="section_box" style="margin-bottom:10px; background-color:#EFF8FF;">
	  <% form_tag({}, {:method => :get, :id => "translations_search_form"}) do %>
	     <%=hidden_field_tag(:section_key, @section_key) %>
	     <%=hidden_field_tag(:translation_key_id, @translation_key.id) %>
	     <div style="float:right">
	          <button type="submit" class="translator_btn translator_small_btn" onClick="$('translations_search_form').submit(); return false;">
	              <span><%=trl("Search")%></span>
	          </button>
	     </div>
	     <div style="padding-top:5px;">
	          <%=trl("Show")%>
	          <%=select_tag(:with_status, options_for_select(Tr8n::Translation.search_status_options, params[:with_status]))%>
	          <%=trl("submitted by")%>
	          <%=select_tag(:submitted_by, options_for_select(Tr8n::Translation.search_submitter_options, params[:submitted_by]))%>
	          <%=trl("created on")%>
	          <%=select_tag(:submitted_on, options_for_select(Tr8n::Translation.search_date_options, params[:submitted_on]))%>
	     </div>
	  <% end %>
	</div>
	  
  <div class="section_box">
    <%= render :partial => "/tr8n/common/paginator", :locals => {:objects => @translations, :subject => 'translation'} %>
    
    <table style="width:100%;" cellpadding="5px" cellspacing="3px">
      <tr style="border-bottom:1px solid #ccc;">
        <td class="topic_header" style="width:200px;"><%=trl("Translator")%></td>
        <td class="topic_header" style="width:25px;"><%=trl("Rank")%></td>
        <td class="topic_header" style="width:80px;text-align:center"><%=trl("Your Vote")%></td>
        <td class="topic_header" style=""><%=trl("Translation")%></td>
        <td class="topic_header" style="width:50px;">&nbsp;</td>
      </tr>  
    
      <% @translations.each do |trn| %>
        <% style = "border-bottom:1px dotted #ccc;" unless @translations.last == trn %>
        <tr style="<%=style%>" id="translation_row_<%=trn.id%>">
          <%= render :partial => "/tr8n/translations/translation", :locals => {:translation => trn, :mode => :view, :show_actions => true} %>
        </tr>
      <% end %>
    </table>
    
    <%= render :partial => "/tr8n/common/paginator", :locals => {:objects => @translations, :subject => 'translation'} %>
  </div>
  
  <% unless @translation_key.locked? %>
    <div style="font-size: 12px; color: grey; padding-top:20px; padding-bottom:15px;">
    <%=trl("You can only edit or delete translations submitted by you. If you don't like any of the translations for this phrase, {add_your_own_link}.", "",
          :add_your_own_link => link_to_function(trl("add your own translation"), "Effect.BlindUp('tranlsations_list', { duration: 0.2 }); Effect.BlindDown('new_translation', { duration: 0.2 });")) %> 
    </div>
  <% end %>
  
</div>

<%= render :partial => "translate" %>

<% if @show_add_dialog %>
	<script>
//    $('tranlsations_list').hide(); 
//    $('new_translation').show();

		window.setTimeout(function() {
	    Effect.BlindUp('tranlsations_list', { duration: 0.2 }); 
	    Effect.BlindDown('new_translation', { duration: 0.2 });
		}, 500);
	</script>	
<% end %>

<script>
  function editTranslationRow(translation_id, section_key) {
    $('votes_for_' + translation_id).hide();
    $('spinner_for_' + translation_id).show();
    location = "/tr8n/translations/view?translation_id=" + translation_id + "&section_key=" + section_key;
  }
  
  function deleteTranslationRow(translation_id, section_key) {
    if (!confirm("<%=trl('Are you sure you want to delete this translation?')%>")) {
      return;
    }
    
    $('votes_for_' + translation_id).hide();
    $('spinner_for_' + translation_id).show();
    location = "/tr8n/translations/delete?translation_id=" + translation_id + "&section_key=" + section_key;
  }
  
  function updateTranslationRow(translation_id, mode) {
    $('votes_for_' + translation_id).hide();
    $('spinner_for_' + translation_id).show();
    
    new Ajax.Updater('translation_row_' + translation_id, '/tr8n/translations/update', {
      parameters: {translation_id:translation_id, mode:mode},
      evalScripts: true,
      method: 'get'
    });
  }
  
  function submitTranslationRow(translation_id) {
    $('votes_for_' + translation_id).hide();
    $('spinner_for_' + translation_id).show();
    
    new Ajax.Updater('translation_row_' + translation_id, '/tr8n/translations/update', {
      parameters: {translation_id:translation_id, label:$("translation_row_value_" + translation_id).value},
      evalScripts: true,
      method: 'post'
    });
  }
</script>

<%= render :partial => "/tr8n/common/footer" %>
