<% form_for(:translation, @translation, :url => {:controller => "/tr8n/translations", :action => :translate}, :html => {:id => 'translator_form', :method => :post}) do |f| %>
    <%= hidden_field_tag(:translation_key_id, @translation_key.id) %>
    <%= hidden_field_tag(:translation_id, @translation.id) %>
    <%= hidden_field_tag(:source_url, @source_url) %>
    <%= hidden_field_tag(:translation_has_dependencies, "false") %>
    
    <div style="padding:10px;padding-bottom:0px;">
        <%= render(:partial => "translator_header")%>
      
        <div id="translator_translation_container"> 
            <div class="strong small" style="padding-top:10px;"><%=trl("Enter #{tr8n_current_language.english_name} Translation:")%></div>
            <%= f.text_area(:label, :id => "translator_text_area", :class => "keyboardInput", :style=>"width:355px;") %>
            
            <% if Tr8n::Config.enable_software_keyboard? %> 
              <script>
                VKI_attach(document.getElementById('translator_text_area'));
              </script>
            <% end %>
    
            <% if @translations.size > 0 %>
              <div style="float:right;"><%= link_to_function(trl('Vote on existing translations for this phrase'), "tr8nTranslator.switchTranslatorMode('#{@translation_key.id}', 'votes')", :class => "small") %></div>
            <% end %>
            
            <% if @translation_key.sanitized_tokens? %>
              <div id="translator_tokens_container" class="tokens_container">
                Tokens: 
                <% @translation_key.sanitized_tokens.each do |token| %>
                  <%= link_to_function(token, "tr8nTranslator.insertAtCaret('translator_text_area', '#{token}');", :title => trl("Tip: Click to insert this token above") ) %>
                <% end %>
              </div>
            <% end %>
            
            <% if tr8n_current_language.has_rules? %>
              <div style="font-size:10px; padding-top:10px;">
              <% if @translation_key.language_rules_dependant_tokens.size > 1 %>
                  <%=link_to_function(trl("Click here if the translation depends on any of the {token} values or the viewing user's gender", "", :token => "{token}"), "tr8nTranslator.switchTranslatorMode('#{@translation_key.id}', 'dependencies', '#{@source_url}')", :class=>"translation_action") %>
              <% elsif tr8n_current_language.has_gender_rules? %>
                  <%=hidden_field_tag("dependencies[viewing_user][gender]", "true")%>
                  <%=link_to_function(trl("Click here if the translation depends on the viewing user's gender"), "tr8nTranslator.submitViewingUserDependency()") %>
              <% end %>
              </div>
            <% end %>        
        </div>
    </div> 
        
    <div id="translator_hints_container" class="hints_container" style="display:none">
      <%= render :partial => "translator_hints" %>
    </div>  
<% end %>

<div id="translator_buttons_container" class="buttons_container">
    <button type="submit" class="translator_btn translator_submit_btn" onClick="tr8nTranslator.submitTranslation(); return false;">
        <span><%=trl("Translate")%></span>
    </button>
</div>

<script>
  $("translator_text_area").focus();
</script>
