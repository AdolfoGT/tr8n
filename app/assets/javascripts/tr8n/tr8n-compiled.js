window&&!window.InflectionJS&&(window.InflectionJS=null);
InflectionJS={uncountable_words:"equipment,information,rice,money,species,series,fish,sheep,moose,deer,news".split(","),plural_rules:[[RegExp("(m)an$","gi"),"$1en"],[RegExp("(pe)rson$","gi"),"$1ople"],[RegExp("(child)$","gi"),"$1ren"],[RegExp("^(ox)$","gi"),"$1en"],[RegExp("(ax|test)is$","gi"),"$1es"],[RegExp("(octop|vir)us$","gi"),"$1i"],[RegExp("(alias|status)$","gi"),"$1es"],[RegExp("(bu)s$","gi"),"$1ses"],[RegExp("(buffal|tomat|potat)o$","gi"),"$1oes"],[RegExp("([ti])um$","gi"),"$1a"],[RegExp("sis$",
"gi"),"ses"],[RegExp("(?:([^f])fe|([lr])f)$","gi"),"$1$2ves"],[RegExp("(hive)$","gi"),"$1s"],[RegExp("([^aeiouy]|qu)y$","gi"),"$1ies"],[RegExp("(x|ch|ss|sh)$","gi"),"$1es"],[RegExp("(matr|vert|ind)ix|ex$","gi"),"$1ices"],[RegExp("([m|l])ouse$","gi"),"$1ice"],[RegExp("(quiz)$","gi"),"$1zes"],[RegExp("s$","gi"),"s"],[RegExp("$","gi"),"s"]],singular_rules:[[RegExp("(m)en$","gi"),"$1an"],[RegExp("(pe)ople$","gi"),"$1rson"],[RegExp("(child)ren$","gi"),"$1"],[RegExp("([ti])a$","gi"),"$1um"],[RegExp("((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$",
"gi"),"$1$2sis"],[RegExp("(hive)s$","gi"),"$1"],[RegExp("(tive)s$","gi"),"$1"],[RegExp("(curve)s$","gi"),"$1"],[RegExp("([lr])ves$","gi"),"$1f"],[RegExp("([^fo])ves$","gi"),"$1fe"],[RegExp("([^aeiouy]|qu)ies$","gi"),"$1y"],[RegExp("(s)eries$","gi"),"$1eries"],[RegExp("(m)ovies$","gi"),"$1ovie"],[RegExp("(x|ch|ss|sh)es$","gi"),"$1"],[RegExp("([m|l])ice$","gi"),"$1ouse"],[RegExp("(bus)es$","gi"),"$1"],[RegExp("(o)es$","gi"),"$1"],[RegExp("(shoe)s$","gi"),"$1"],[RegExp("(cris|ax|test)es$","gi"),"$1is"],
[RegExp("(octop|vir)i$","gi"),"$1us"],[RegExp("(alias|status)es$","gi"),"$1"],[RegExp("^(ox)en","gi"),"$1"],[RegExp("(vert|ind)ices$","gi"),"$1ex"],[RegExp("(matr)ices$","gi"),"$1ix"],[RegExp("(quiz)zes$","gi"),"$1"],[RegExp("s$","gi"),""]],non_titlecased_words:"and,or,nor,a,an,the,so,but,to,of,at,by,from,into,on,onto,off,out,in,over,with,for".split(","),id_suffix:RegExp("(_ids|_id)$","g"),underbar:RegExp("_","g"),space_or_underbar:RegExp("[ _]","g"),uppercase:RegExp("([A-Z])","g"),underbar_prefix:/^_/,
apply_rules:function(a,b,c,d){if(d)a=d;else if(!(c.indexOf(a.toLowerCase())>-1))for(c=0;c<b.length;c++)if(a.match(b[c][0])){a=a.replace(b[c][0],b[c][1]);break}return a}};Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b,c){b||(b=-1);for(var d=-1;b<this.length;b++)if(this[b]===a||c&&c(this[b],a)){d=b;break}return d});String.prototype._uncountable_words||(String.prototype._uncountable_words=InflectionJS.uncountable_words);
String.prototype._plural_rules||(String.prototype._plural_rules=InflectionJS.plural_rules);String.prototype._singular_rules||(String.prototype._singular_rules=InflectionJS.singular_rules);String.prototype._non_titlecased_words||(String.prototype._non_titlecased_words=InflectionJS.non_titlecased_words);String.prototype.pluralize||(String.prototype.pluralize=function(a){return InflectionJS.apply_rules(this,this._plural_rules,this._uncountable_words,a)});
String.prototype.singularize||(String.prototype.singularize=function(a){return InflectionJS.apply_rules(this,this._singular_rules,this._uncountable_words,a)});var MD5=function(a){function b(a,b){var c,d,g,e,f;g=a&2147483648;e=b&2147483648;c=a&1073741824;d=b&1073741824;f=(a&1073741823)+(b&1073741823);return c&d?f^2147483648^g^e:c|d?f&1073741824?f^3221225472^g^e:f^1073741824^g^e:f^g^e}function c(a,c,d,g,f,e,h){a=b(a,b(b(c&d|~c&g,f),h));return b(a<<e|a>>>32-e,c)}function d(a,c,d,g,e,f,h){a=b(a,b(b(c&g|d&~g,e),h));return b(a<<f|a>>>32-f,c)}function g(a,c,d,g,f,e,h){a=b(a,b(b(c^d^g,f),h));return b(a<<e|a>>>32-e,c)}function l(a,c,d,g,e,f,h){a=b(a,b(b(d^(c|~g),
e),h));return b(a<<f|a>>>32-f,c)}function m(a){var b="",c="",d;for(d=0;3>=d;d++)c=a>>>8*d&255,c="0"+c.toString(16),b+=c.substr(c.length-2,2);return b}var k=[],n,o,q,r,e,f,h,j,a=function(a){for(var a=a.replace(/\r\n/g,"\n"),c="",b=0;b<a.length;b++){var d=a.charCodeAt(b);128>d?c+=String.fromCharCode(d):(127<d&&2048>d?c+=String.fromCharCode(d>>6|192):(c+=String.fromCharCode(d>>12|224),c+=String.fromCharCode(d>>6&63|128)),c+=String.fromCharCode(d&63|128))}return c}(a),k=function(a){var c,b=a.length;c=
b+8;for(var d=16*((c-c%64)/64+1),f=Array(d-1),g=0,e=0;e<b;)c=(e-e%4)/4,g=8*(e%4),f[c]|=a.charCodeAt(e)<<g,e++;c=(e-e%4)/4;f[c]|=128<<8*(e%4);f[d-2]=b<<3;f[d-1]=b>>>29;return f}(a);e=1732584193;f=4023233417;h=2562383102;j=271733878;for(a=0;a<k.length;a+=16)n=e,o=f,q=h,r=j,e=c(e,f,h,j,k[a+0],7,3614090360),j=c(j,e,f,h,k[a+1],12,3905402710),h=c(h,j,e,f,k[a+2],17,606105819),f=c(f,h,j,e,k[a+3],22,3250441966),e=c(e,f,h,j,k[a+4],7,4118548399),j=c(j,e,f,h,k[a+5],12,1200080426),h=c(h,j,e,f,k[a+6],17,2821735955),
f=c(f,h,j,e,k[a+7],22,4249261313),e=c(e,f,h,j,k[a+8],7,1770035416),j=c(j,e,f,h,k[a+9],12,2336552879),h=c(h,j,e,f,k[a+10],17,4294925233),f=c(f,h,j,e,k[a+11],22,2304563134),e=c(e,f,h,j,k[a+12],7,1804603682),j=c(j,e,f,h,k[a+13],12,4254626195),h=c(h,j,e,f,k[a+14],17,2792965006),f=c(f,h,j,e,k[a+15],22,1236535329),e=d(e,f,h,j,k[a+1],5,4129170786),j=d(j,e,f,h,k[a+6],9,3225465664),h=d(h,j,e,f,k[a+11],14,643717713),f=d(f,h,j,e,k[a+0],20,3921069994),e=d(e,f,h,j,k[a+5],5,3593408605),j=d(j,e,f,h,k[a+10],9,38016083),
h=d(h,j,e,f,k[a+15],14,3634488961),f=d(f,h,j,e,k[a+4],20,3889429448),e=d(e,f,h,j,k[a+9],5,568446438),j=d(j,e,f,h,k[a+14],9,3275163606),h=d(h,j,e,f,k[a+3],14,4107603335),f=d(f,h,j,e,k[a+8],20,1163531501),e=d(e,f,h,j,k[a+13],5,2850285829),j=d(j,e,f,h,k[a+2],9,4243563512),h=d(h,j,e,f,k[a+7],14,1735328473),f=d(f,h,j,e,k[a+12],20,2368359562),e=g(e,f,h,j,k[a+5],4,4294588738),j=g(j,e,f,h,k[a+8],11,2272392833),h=g(h,j,e,f,k[a+11],16,1839030562),f=g(f,h,j,e,k[a+14],23,4259657740),e=g(e,f,h,j,k[a+1],4,2763975236),
j=g(j,e,f,h,k[a+4],11,1272893353),h=g(h,j,e,f,k[a+7],16,4139469664),f=g(f,h,j,e,k[a+10],23,3200236656),e=g(e,f,h,j,k[a+13],4,681279174),j=g(j,e,f,h,k[a+0],11,3936430074),h=g(h,j,e,f,k[a+3],16,3572445317),f=g(f,h,j,e,k[a+6],23,76029189),e=g(e,f,h,j,k[a+9],4,3654602809),j=g(j,e,f,h,k[a+12],11,3873151461),h=g(h,j,e,f,k[a+15],16,530742520),f=g(f,h,j,e,k[a+2],23,3299628645),e=l(e,f,h,j,k[a+0],6,4096336452),j=l(j,e,f,h,k[a+7],10,1126891415),h=l(h,j,e,f,k[a+14],15,2878612391),f=l(f,h,j,e,k[a+5],21,4237533241),
e=l(e,f,h,j,k[a+12],6,1700485571),j=l(j,e,f,h,k[a+3],10,2399980690),h=l(h,j,e,f,k[a+10],15,4293915773),f=l(f,h,j,e,k[a+1],21,2240044497),e=l(e,f,h,j,k[a+8],6,1873313359),j=l(j,e,f,h,k[a+15],10,4264355552),h=l(h,j,e,f,k[a+6],15,2734768916),f=l(f,h,j,e,k[a+13],21,1309151649),e=l(e,f,h,j,k[a+4],6,4149444226),j=l(j,e,f,h,k[a+11],10,3174756917),h=l(h,j,e,f,k[a+2],15,718787259),f=l(f,h,j,e,k[a+9],21,3951481745),e=b(e,n),f=b(f,o),h=b(h,q),j=b(j,r);return(m(e)+m(f)+m(h)+m(j)).toLowerCase()};document.createElement("tr8n");var Tr8n=Tr8n||{element:function(a){return"string"==typeof a?document.getElementById(a):a},value:function(a){return Tr8n.element(a).value}};Tr8n.Utils={hideFlash:function(){var a=document.getElementsByTagName("embed");for(i=0;i<a.length;i++)a[i].style.visibility="hidden"},showFlash:function(){var a=document.getElementsByTagName("embed");for(i=0;i<a.length;i++)a[i].style.visibility="visible"},isOpera:function(){return/Opera/.test(navigator.userAgent)},addEvent:function(a,b,c,d){d=d||!1;if(a.addEventListener)return a.addEventListener(b,c,d),!0;if(a.attachEvent)return a.attachEvent("on"+b,c);a["on"+b]=c},toQueryParams:function(a){if("undefined"==
typeof a||null==a)return"";if("string"==typeof a)return a;var b=[];for(p in a)b.push(p+"="+encodeURIComponent(a[p]));return b.join("&")},serializeForm:function(a){var a=Tr8n.element(a).elements,b={};for(i=0;i<a.length;i++)if("checkbox"!=a[i].type||a[i].checked)b[a[i].name]=a[i].value;return b},indexOf:function(a,b,c){c||(c=0);var d=a.length;for(0>c&&(c=d+c);c<d;c++)if(a[c]===b)return c;return-1},replaceAll:function(a,b,c){for(;-1!=a.indexOf(b);)a=a.replace(b,c);return a},trim:function(a){return a.replace(/^\s+|\s+$/g,
"")},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,"")},getRequest:function(){for(var a=[function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=0;b<a.length;b++)try{var c=a[b]();if(null!=c)return c}catch(d){}},ajax:function(a,b){b=b||{};b.parameters=Tr8n.Utils.toQueryParams(b.parameters);b.method=b.method||"get";var c=this;"get"==b.method&&""!=b.parameters&&
(a=a+(-1==a.indexOf("?")?"?":"&")+b.parameters);var d=this.getRequest();d.onreadystatechange=function(){if(4==d.readyState)if(200==d.status){if(b.onSuccess)b.onSuccess(d);if(b.onComplete)b.onComplete(d);b.evalScripts&&c.evalScripts(d.responseText)}else{if(b.onFailure)b.onFailure(d);if(b.onComplete)b.onComplete(d)}};d.open(b.method,a,!0);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Content-type","application/x-www-form-urlencoded");d.setRequestHeader("Accept","text/javascript, text/html, application/xml, text/xml, */*");
d.send(b.parameters)},update:function(a,b,c){c.onSuccess=function(c){Tr8n.element(a).innerHTML=c.responseText};Tr8n.Utils.ajax(b,c)},evalScripts:function(a){for(var b=/<script[^>]*>([\S\s]*?)<\/script>/im,a=a.match(RegExp("<script[^>]*>([\\S\\s]*?)<\/script>","img"))||[],c=0,d=a.length;c<d;c++){var g=(a[c].match(b)||["",""])[1];eval(g)}},hasClassName:function(a,b){return a.className&&RegExp("(^|\\s)"+b+"($|\\s)").test(a.className)?!0:!1},findElement:function(a,b,c){var d=a||window.event,c=c||d.target||
d.srcElement;return c==document.body?null:(b.match(/^\./)?this.hasClassName(c,b.replace(/^\./,"")):c.tagName.toLowerCase()==b.toLowerCase())?c:this.findElement(a,b,c.parentNode)},cumulativeOffset:function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return[c,b]},wrapText:function(a,b,c){a=document.getElementById(a);if("number"==typeof a.selectionStart){var d=a.selectionStart,g=a.selectionEnd;a.value=a.value.substring(0,d)+b+a.value.substring(d,g)+c+a.value.substring(g,
a.value.length)}else if(document.selection){a.focus();d=document.selection.createRange();if(d.parentElement()!=a)return!1;"string"==typeof d.text&&(document.selection.createRange().text=b+d.text+c)}else a.value+=b+" "+c;return!0},insertAtCaret:function(a,b){var c=document.getElementById(a),d=c.scrollTop,g=0,l=c.selectionStart||"0"==c.selectionStart?"ff":document.selection?"ie":!1;if("ie"==l){c.focus();var m=document.selection.createRange();m.moveStart("character",-c.value.length);g=m.text.length}else"ff"==
l&&(g=c.selectionStart);var m=c.value.substring(0,g),k=c.value.substring(g,c.value.length);c.value=m+b+k;g+=b.length;"ie"==l?(c.focus(),m=document.selection.createRange(),m.moveStart("character",-c.value.length),m.moveStart("character",g),m.moveEnd("character",0),m.select()):"ff"==l&&(c.selectionStart=g,c.selectionEnd=g,c.focus());c.scrollTop=d},toggleKeyboards:function(){if(VKI_attach)if(this.keyboardMode)window.location.reload();else{this.keyboardMode=!0;var a=document.getElementsByTagName("input");
for(i=0;i<a.length;i++)"text"==a[i].type&&VKI_attach(a[i]);a=document.getElementsByTagName("textarea");for(i=0;i<a.length;i++)VKI_attach(a[i])}},displayShortcuts:function(){tr8nLightbox&&tr8nLightbox.show("/tr8n/help/lb_shortcuts",{width:400,height:480})},displayStatistics:function(){tr8nLightbox&&tr8nLightbox.show("/tr8n/help/lb_stats",{width:420,height:400})}};Tr8n.Effects={toggle:function(a){"none"==Tr8n.element(a).style.display?Tr8n.element(a).show():Tr8n.element(a).hide()},hide:function(a){Tr8n.element(a).style.display="none"},show:function(a){var b="SPAN"==Tr8n.element(a).tagName?"inline":"block";Tr8n.element(a).style.display=b},blindUp:function(a){Tr8n.Effects.hide(a)},blindDown:function(a){Tr8n.Effects.show(a)},appear:function(a){Tr8n.Effects.show(a)},fade:function(a){Tr8n.Effects.hide(a)},submit:function(a){Tr8n.element(a).submit()},focus:function(a){Tr8n.element(a).focus()},
scrollTo:function(a){for(var a=Tr8n.element(a),b=0,c=0;null!=a;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;window.scrollTo(b,c)}};Tr8n.LanguageCaseManager=function(a){var b=this;this.options=a;this.case_key=null;this.container=document.createElement("div");this.container.className="tr8n_language_case_manager";this.container.id="tr8n_language_case_manager";this.container.style.display="none";document.body.appendChild(this.container);a=Tr8n.Utils.isOpera()?"click":"contextmenu";Tr8n.Utils.addEvent(document,a,function(a){if(!Tr8n.Utils.isOpera()||a.ctrlKey){var d=Tr8n.Utils.findElement(a,".tr8n_language_case"),g=Tr8n.Utils.findElement(a,
"a");if(null!=d){if(g){var l=g.href;g.href="javascript:void(0);";setTimeout(function(){g.href=l},500)}a.stop&&a.stop();a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();b.show(d)}}})};
Tr8n.LanguageCaseManager.prototype={hide:function(){this.container.style.display="none";Tr8n.Utils.showFlash()},show:function(a){var b=this;tr8nLanguageSelector&&tr8nLanguageSelector.hide();tr8nLightbox&&tr8nLightbox.hide();tr8nTranslator&&tr8nTranslator.hide();Tr8n.Utils.hideFlash();var c="",d=Tr8n.element("tr8n_splash_screen"),c=d?c+d.innerHTML:c+"<div style='font-size:18px;text-align:center; margin:5px; padding:10px; background-color:black;'>  <img src='/assets/tr8n/tr8n_logo.jpg' style='width:280px; vertical-align:middle;'>  <img src='/assets/tr8n/loading3.gif' style='width:200px; height:20px; vertical-align:middle;'></div>";
this.container.innerHTML=c;this.container.style.display="block";var g="left",c=a.offsetWidth,l=a.offsetHeight,d=Tr8n.Utils.cumulativeOffset(a),m=d[0]+"px",l=d[1]+l+12+"px",k=c/2,n=d[1]-100;window.innerWidth<d[0]+c+window.innerWidth/2&&(m=d[0]+c-this.container.offsetWidth+"px",k=c/2,g="right");window.scrollTo(d[0],n);this.container.style.left=m;this.container.style.top=l;this.case_id=a.getAttribute("case_id");this.rule_id=a.getAttribute("rule_id");this.case_key=a.getAttribute("case_key");window.setTimeout(function(){Tr8n.Utils.update("tr8n_language_case_manager",
"/tr8n/language_cases/manager",{evalScripts:true,parameters:{case_id:b.case_id,rule_id:b.rule_id,case_key:b.case_key,stem_type:"top_"+g,stem_offset:k}})},500)},switchToCaseMapMode:function(){Tr8n.Effects.hide("tr8n_language_case_container");Tr8n.Effects.show("tr8n_language_case_exception_container")},switchCaseMapMode:function(a){Tr8n.Utils.update("tr8n_language_cases_form","/tr8n/language_cases/switch_manager_mode",{evalScripts:!0,parameters:{mode:a,case_key:this.case_key}})},reportCaseMap:function(){confirm("Reporting these values will remove them from the system and the translator will be put on a watch list. \n\nAre you sure you want to report these values?")&&
(Tr8n.element("tr8n_language_case_form").action="/tr8n/language_cases/report_value_map",Tr8n.Effects.hide("tr8n_language_case_exception_container"),Tr8n.Effects.show("tr8n_language_case_report_spinner"),Tr8n.Effects.submit("tr8n_language_case_form"))},submitCaseMap:function(){Tr8n.Effects.hide("tr8n_language_case_exception_container");Tr8n.Effects.show("tr8n_language_case_submit_spinner");Tr8n.Effects.submit("tr8n_language_case_form")}};Tr8n.LanguageSelector=function(a){this.options=a||{};this.loaded=this.keyboardMode=!1;this.container=document.createElement("div");this.container.className="tr8n_language_selector";this.container.id="tr8n_language_selector";this.container.style.display="none";document.body.appendChild(this.container)};
Tr8n.LanguageSelector.prototype={toggle:function(){"none"==this.container.style.display?this.show():this.hide()},hide:function(){this.container.style.display="none";Tr8n.Utils.showFlash()},show:function(){tr8nTranslator&&tr8nTranslator.hide();tr8nLightbox&&tr8nLightbox.hide();tr8nLanguageCaseManager&&tr8nLanguageCaseManager.hide();Tr8n.Utils.hideFlash();var a=Tr8n.element("tr8n_splash_screen");if(!this.loaded){var b="",b=a?b+a.innerHTML:b+"<div style='font-size:18px;text-align:center; margin:5px; padding:10px; background-color:black;'>  <img src='/assets/tr8n/tr8n_logo.jpg' style='width:280px; vertical-align:middle;'>  <img src='/assets/tr8n/loading3.gif' style='width:200px; height:20px; vertical-align:middle;'></div>";
this.container.innerHTML=b}this.container.style.display="block";var a=Tr8n.element("tr8n_language_selector_trigger"),b=Tr8n.Utils.cumulativeOffset(a),c=b[1]+a.offsetHeight+4+"px";this.container.style.left=b[0]+a.offsetWidth-this.container.offsetWidth+"px";this.container.style.top=c;this.loaded||window.setTimeout(function(){Tr8n.Utils.update("tr8n_language_selector","/tr8n/language/select",{evalScripts:!0})},100);this.loaded=!0},removeLanguage:function(a){Tr8n.Utils.update("tr8n_language_lists","/tr8n/language/lists",
{parameters:{language_action:"remove",language_id:a},method:"post"})},enableInlineTranslations:function(){window.location="/tr8n/language/switch?language_action=enable_inline_mode&source_url="+location},disableInlineTranslations:function(){window.location="/tr8n/language/switch?language_action=disable_inline_mode&source_url="+location},showDashboard:function(){window.location="/tr8n/dashboard"},manageLanguage:function(){window.location="/tr8n/language"},toggleInlineTranslations:function(){window.location=
"/tr8n/language/switch?language_action=toggle_inline_mode&source_url="+location}};Tr8n.Lightbox=function(){this.container=document.createElement("div");this.container.className="tr8n_lightbox";this.container.id="tr8n_lightbox";this.container.style.display="none";this.overlay=document.createElement("div");this.overlay.className="tr8n_lightbox_overlay";this.overlay.id="tr8n_lightbox_overlay";this.overlay.style.display="none";document.body.appendChild(this.container);document.body.appendChild(this.overlay)};
Tr8n.Lightbox.prototype={hide:function(){this.container.style.display="none";this.overlay.style.display="none";Tr8n.Utils.showFlash()},show:function(a,b){b=b||{};tr8nTranslator&&tr8nTranslator.hide();tr8nLanguageSelector&&tr8nLanguageSelector.hide();tr8nLanguageCaseManager&&tr8nLanguageCaseManager.hide();Tr8n.Utils.hideFlash();this.container.innerHTML="<div class='inner'><div class='bd'><img src='/assets/tr8n/spinner.gif' style='vertical-align:middle'> Loading...</div></div>";this.overlay.style.display=
"block";b.width=b.width||700;b.height=b.height||520;this.container.style.width=b.width+"px";this.container.style.height=b.height+"px";this.container.style.marginLeft=-b.width/2+"px";this.container.style.marginTop=-b.height/2+"px";this.container.style.display="block";Tr8n.Utils.update("tr8n_lightbox",a,{evalScripts:!0})}};Tr8n.Translator=function(a){var b=this;this.options=a;this.suggestion_tokens=this.translation_key_id=null;this.container=document.createElement("div");this.container.className="tr8n_translator";this.container.id="tr8n_translator";this.container.style.display="none";document.body.appendChild(this.container);a=Tr8n.Utils.isOpera()?"click":"contextmenu";Tr8n.Utils.addEvent(document,a,function(a){if(!Tr8n.Utils.isOpera()||a.ctrlKey){var d=Tr8n.Utils.findElement(a,".tr8n_translatable"),g=Tr8n.Utils.findElement(a,
"a");if(null!=d){if(g){var l=g.href;g.href="javascript:void(0);";setTimeout(function(){g.href=l},500)}a.stop&&a.stop();a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();b.show(d);return!1}}})};
Tr8n.Translator.prototype={hide:function(){this.container.style.display="none";Tr8n.Utils.showFlash()},show:function(a){var b=this;tr8nLanguageSelector&&tr8nLanguageSelector.hide();tr8nLightbox&&tr8nLightbox.hide();tr8nLanguageCaseManager&&tr8nLanguageCaseManager.hide();Tr8n.Utils.hideFlash();var c="",d=Tr8n.element("tr8n_splash_screen"),c=d?c+d.innerHTML:c+"<div style='font-size:18px;text-align:center; margin:5px; padding:10px; background-color:black;'>  <img src='/assets/tr8n/tr8n_logo.jpg' style='width:280px; vertical-align:middle;'>  <img src='/assets/tr8n/loading3.gif' style='width:200px; height:20px; vertical-align:middle;'></div>";
this.container.innerHTML=c;this.container.style.display="block";var g="left",c=a.offsetWidth,l=a.offsetHeight,d=Tr8n.Utils.cumulativeOffset(a),m=d[0]+"px",l=d[1]+l+12+"px",k=c/2,n=d[1]-100;window.innerWidth<d[0]+c+window.innerWidth/2&&(m=d[0]+c-this.container.offsetWidth+"px",k=c/2,g="right");window.scrollTo(d[0],n);this.container.style.left=m;this.container.style.top=l;this.translation_key_id=a.getAttribute("translation_key_id");window.setTimeout(function(){Tr8n.Utils.update("tr8n_translator","/tr8n/language/translator",
{evalScripts:true,parameters:{translation_key_id:b.translation_key_id,stem_type:"top_"+g,stem_offset:k}})},500)},reportTranslation:function(a,b){confirm("Reporting this translation will remove it from this list and the translator will be put on a watch list. \n\nAre you sure you want to report this translation?")&&this.voteOnTranslation(a,b,-1E3)},voteOnTranslation:function(a,b,c){Tr8n.Effects.hide("tr8n_votes_for_"+b);Tr8n.Effects.show("tr8n_spinner_for_"+b);Tr8n.element("tr8n_translator_votes_for_"+
a)?Tr8n.Utils.update("tr8n_translator_votes_for_"+a,"/tr8n/translations/vote",{parameters:{translation_id:b,vote:c},method:"post"}):Tr8n.Utils.update("tr8n_votes_for_"+b,"/tr8n/translations/vote",{parameters:{translation_id:b,vote:c,short_version:!0},method:"post",onComplete:function(){Tr8n.Effects.hide("tr8n_spinner_for_"+b);Tr8n.Effects.show("tr8n_votes_for_"+b)}})},insertDecorationToken:function(a,b){Tr8n.Utils.wrapText(b||"tr8n_translator_translation_label","["+a+": ","]")},insertToken:function(a,
b){Tr8n.Utils.insertAtCaret(b||"tr8n_translator_translation_label","{"+a+"}")},switchTranslatorMode:function(a,b,c){Tr8n.Utils.update("tr8n_translator_container","/tr8n/language/translator",{parameters:{translation_key_id:a,mode:b,source_url:c},evalScripts:!0})},submitTranslation:function(){Tr8n.Effects.hide("tr8n_translator_translation_container");Tr8n.Effects.hide("tr8n_translator_buttons_container");Tr8n.Effects.show("tr8n_translator_spinner");Tr8n.Effects.submit("tr8n_translator_form")},submitViewingUserDependency:function(){Tr8n.element("tr8n_translator_translation_has_dependencies").value=
"true";this.submitTranslation()},submitDependencies:function(){Tr8n.Effects.hide("tr8n_translator_buttons_container");Tr8n.Effects.hide("tr8n_translator_dependencies_container");Tr8n.Effects.show("tr8n_translator_spinner");Tr8n.element("tr8n_translator_form").action="/tr8n/translations/permutate";Tr8n.Effects.submit("tr8n_translator_form")},translate:function(a,b,c){c=c||{};Tr8n.Utils.ajax("/tr8n/language/translate",{method:"post",parameters:{label:a,description:c.description,tokens:c.tokens,options:c.options,
language:c.language},onSuccess:function(a){b&&b(a.responseText)}})},translateBatch:function(a,b){Tr8n.Utils.ajax("/tr8n/language/translate",{method:"post",parameters:{phrases:a},onSuccess:function(a){b&&b(a.responseText)}})},processSuggestedTranslation:function(a){if(!(null==a||null==a.data||null==a.data.translations||0==a.data.translations.length)){a=a.data.translations[0].translatedText;if(this.suggestion_tokens){var b=this.suggestion_tokens.split(",");this.suggestion_tokens=null;for(var c=0;c<
b.length;c++)a=Tr8n.Utils.replaceAll(a,"("+c+")",b[c])}Tr8n.element("tr8n_translation_suggestion_"+this.translation_key_id).innerHTML=a;Tr8n.element("tr8n_google_suggestion_container_"+this.translation_key_id).style.display="block";if(a=Tr8n.element("tr8n_google_suggestion_section"))a.style.display="block"}},suggestTranslation:function(a,b,c,d,g){null!=Tr8n.google_api_key&&(this.suggestion_tokens=c,this.translation_key_id=a,a=document.createElement("script"),a.type="text/javascript",b=escape(b),a.src=
"https://www.googleapis.com/language/translate/v2?key="+Tr8n.google_api_key+"&source="+d+"&target="+g+"&callback=tr8nTranslator.processSuggestedTranslation&q="+b,document.getElementsByTagName("head")[0].appendChild(a))}};Tr8n.Proxy=function(a){this.options=a;this.options.url=this.options.url||"/tr8n/api/v1/language/translate";this.options.scheduler_interval=this.options.scheduler_interval||2E4;this.missing_translations_locked=this.logger_enabled=!1;this.inline_translations_enabled=this.options.enable_inline_translations;this.logger=new Tr8n.Proxy.Logger({proxy:this,element_id:a.logger_element_id||"tr8n_debugger"});this.language=new Tr8n.Proxy.Language({proxy:this});this.initTranslations();this.runScheduledTasks()};
Tr8n.Proxy.prototype={log:function(a){this.logger.debug(a)},logSettings:function(){this.logger.clear();this.logger.logObject(this.options)},logTranslations:function(){this.logger.clear();this.translations=this.translations||{};this.logger.logObject(this.translations)},logMissingTranslations:function(){this.logger.clear();this.missing_translation_keys=this.missing_translation_keys||{};this.logger.logObject(this.missing_translation_keys)},disableLogger:function(){this.logger_enabled=!1},enableLogger:function(){this.logger_enabled=
!0},debug:function(a){this.logger.debug(a)},error:function(a){this.logger.error(a)},translate:function(a,b,c,d){if(!a)return"";c=c||{};d=d||{};return this.language.translate(a,b||"",c,d)},tr:function(a,b,c,d){return this.translate(a,b,c,d)},trl:function(a,b,c,d){d=d||{};d.skip_decorations=!0;return this.translate(a,b,c,d)},getTranslations:function(){return this.translations=this.translations||{}},getDecorationFor:function(a){return!this.options.default_decorations?null:this.options.default_decorations[a]},
getLanguageRuleForType:function(a){return"number"==a?"Tr8n.Proxy.NumericRule":"gender"==a?"Tr8n.Proxy.GenderRule":"date"==a?"Tr8n.Proxy.DateRule":"list"==a?"Tr8n.Proxy.ListRule":"gender_list"==a?"Tr8n.Proxy.GenderListRule":null},getLanguageRuleForTokenSuffix:function(a){if(!this.options.rules)return null;for(rule_type in this.options.rules){var b=this.options.rules[rule_type].token_suffixes;if(b&&-1!=Tr8n.Utils.indexOf(b,a))return this.getLanguageRuleForType(rule_type)}return null},registerTranslationKeys:function(a){this.log("Found "+
a.length+" registered phrases");for(i=0;i<a.length;i++){var b=a[i];this.log("Registering "+b.key);this.translations[b.key]=b}},initTranslations:function(a){if(a||!this.translations){this.translations={};this.options.translations_cache_id&&(this.log("Registering page translations from translations cache..."),this.updateTranslations(eval(this.options.translations_cache_id)));var b=this;this.options.fetch_translations_on_init&&(this.log("Fetching translations from the server..."),Tr8n.Utils.ajax(this.options.url,
{method:"get",parameters:{batch:!0,source:b.options.default_source},onSuccess:function(a){b.log("Received response from the server");b.log(a.responseText);b.updateTranslations(eval("["+a.responseText+"]")[0].phrases)}}))}},updateTranslations:function(a){this.translations=this.translations||{};this.log("Updating page translations...");this.registerTranslationKeys(a)},registerMissingTranslationKey:function(a,b,c){this.missing_translation_keys=this.missing_translation_keys||{};this.missing_translation_keys[a.key]||
(this.log("Adding missing translation to the queue: "+a.key),this.missing_translation_keys[a.key]={translation_key:a,token_values:b,options:c})},submitMissingTranslationKeys:function(){if(this.missing_translations_locked)this.log("Missing translations are being processed, postponding registration task.");else{this.missing_translation_keys=this.missing_translation_keys||{};var a="[",b;for(b in this.missing_translation_keys){var c=this.missing_translation_keys[b].translation_key;null!=c&&("["!=a&&(a+=
","),a+="{",a=a+'"label":"'+c.label+'", ',a=a+'"description":"'+c.description+'"',a+="}")}a+="]";if("[]"!=a){var d=this;this.debug("Submitting missing translation keys: "+a);Tr8n.Utils.ajax(this.options.url,{method:"put",parameters:{source:d.options.default_source,phrases:a},onSuccess:function(a){d.log("Received response from the server");d.log(a.responseText);d.updateMissingTranslationKeys(eval("["+a.responseText+"]")[0].phrases)}})}}},updateMissingTranslationKeys:function(a){this.missing_translations_locked=
!0;this.log("Received "+a.length+" registered phrases...");for(i=0;i<a.length;i++){var b=a[i];this.log("Registering new key "+b.key);this.translations[b.key]=b;var c=this.missing_translation_keys[b.key],d=Tr8n.element(b.key);d&&c.translation_key&&(d.setAttribute("translation_key_id",b.id),d.innerHTML=c.translation_key.translate(this.language,c.token_values));delete this.missing_translation_keys[c.translation_key.key]}this.missing_translations_locked=!1},runScheduledTasks:function(){var a=this;this.submitMissingTranslationKeys();
window.setTimeout(function(){a.runScheduledTasks()},this.options.scheduler_interval)},parseTml:function(){for(var a=document.createTreeWalker(document.body,NodeFilter.SHOW_ALL,function(a){return"TML:LABEL"==a.nodeName?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP},!1);a.nextNode();)(new Tr8n.Tml.Label(a.currentNode)).translate()}};Tr8n.Proxy.Logger=function(a){this.options=a;this.object_keys=[]};
Tr8n.Proxy.Logger.prototype={clear:function(){this.options.proxy.logger_enabled&&this.options.element_id&&Tr8n.element(this.options.element_id)&&(Tr8n.element(this.options.element_id).innerHTML="")},append:function(a){this.options.proxy.logger_enabled&&this.options.element_id&&Tr8n.element(this.options.element_id)&&(a=a+"<br>"+Tr8n.element(this.options.element_id).innerHTML,Tr8n.element(this.options.element_id).innerHTML=a)},log:function(a){if(this.options.proxy.logger_enabled){var b=new Date;this.append("<span style='color:#ccc;'>"+
(b.toLocaleDateString()+" "+b.toLocaleTimeString())+"</span>: "+a)}},debug:function(a){this.options.proxy.logger_enabled&&(window.console&&console.log&&console.log(a),this.log("<span style='color:grey'>"+a+"</span>"))},error:function(a){this.options.proxy.logger_enabled&&(window.console&&console.error&&console.error(a),this.log("<span style='color:red'>"+a+"</span>"))},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return this.S4()+this.S4()+"-"+this.S4()+
"-"+this.S4()+"-"+this.S4()+"-"+this.S4()+this.S4()+this.S4()},escapeHTML:function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},showObject:function(a,b){b?(Tr8n.Effects.hide("no_object_"+a),Tr8n.Effects.show("object_"+a),Tr8n.element("expander_"+a).innerHTML="<img src='/assets/tr8n/minus_node.png'>"):(Tr8n.Effects.hide("object_"+a),Tr8n.Effects.show("no_object_"+a),Tr8n.element("expander_"+a).innerHTML="<img src='/assets/tr8n/plus_node.png'>")},
toggleNode:function(a){this.showObject(a,"none"==Tr8n.element("object_"+a).style.display)},expandAllNodes:function(){for(var a=0;a<this.object_keys.length;a++)this.showObject(this.object_keys[a],!0)},collapseAllNodes:function(){for(var a=0;a<this.object_keys.length;a++)this.showObject(this.object_keys[a],!1)},logObject:function(a){this.object_keys=[];html=[];html.push("<div style='float:right;padding-right:10px;'>");html.push("<span style='padding:2px;' onClick=\"tr8nProxy.logger.expandAllNodes()\"><img src='/assets/tr8n/plus_node.png'></span>");
html.push("<span style='padding:2px;' onClick=\"tr8nProxy.logger.collapseAllNodes()\"><img src='/assets/tr8n/minus_node.png'></span>");html.push("</div>");if("string"==typeof a)try{a=eval("["+a+"]")[0]}catch(b){this.push(a);return}"object"==typeof a?html.push(this.formatObject(a,1)):html.push(a);this.append(html.join(""))},formatObject:function(a,b){if(null==a)return"{<br>}";var c=[],d=this.guid();c.push("<span class='tr8n_logger_expander' id='expander_"+d+"' onClick=\"tr8nProxy.logger.toggleNode('"+
d+"')\"><img src='/assets/tr8n/minus_node.png'></span> <span style='display:none' id='no_object_"+d+"'>{...}</span> <span id='object_"+d+"'>{");this.object_keys.push(d);for(var d=Object.keys(a).sort(),g=0;g<d.length;g++)key=d[g],this.isObject(a[key])?this.isArray(a[key])?c.push(this.createSpacer(b)+"<span class='tr8n_logger_obj_key'>"+key+":</span>"+this.formatArray(a[key],b+1)+","):c.push(this.createSpacer(b)+"<span class='tr8n_logger_obj_key'>"+key+":</span>"+this.formatObject(a[key],b+1)+","):
c.push(this.createSpacer(b)+this.formatProperty(key,a[key])+",");c.push(this.createSpacer(b-1)+"}</span>");return c.join("<br>")},formatArray:function(a,b){if(null==a)return"[<br>]";var c=[],d=this.guid();c.push("<span class='tr8n_logger_expander' id='expander_"+d+"' onClick=\"tr8nProxy.logger.toggleNode('"+d+"')\"><img src='/assets/tr8n/minus_node.png'></span> <span style='display:none' id='no_object_"+d+"'>[...]</span> <span id='object_"+d+"'>[");this.object_keys.push(d);for(d=0;d<a.length;d++)this.isObject(a[d])?
this.isArray(a[d])?c.push(this.createSpacer(b)+this.formatArray(a[d],b+1)+","):c.push(this.createSpacer(b)+this.formatObject(a[d],b+1)+","):c.push(this.createSpacer(b)+this.formatProperty(null,a[d])+",");c.push(this.createSpacer(b-1)+"]</span>");return c.join("<br>")},formatProperty:function(a,b){if(null==b)return"<span class='tr8n_logger_obj_key'>"+a+":</span><span class='obj_value_null'>null</span>";var c="tr8n_logger_obj_value_"+typeof b,d="",d=this.isString(b)?"<span class='"+c+"'>\""+this.escapeHTML(b)+
'"</span>':"<span class='"+c+"'>"+b+"</span>";return null==a?d:"<span class='tr8n_logger_obj_key'>"+a+":</span>"+d},createSpacer:function(a){return"<img src='/assets/tr8n/pixel.gif' style='height:1px;width:"+20*a+"px;'>"},isArray:function(a){return null==a?!1:-1!=a.constructor.toString().indexOf("Array")},isObject:function(a){return null==a?!1:"object"==typeof a},isString:function(a){return"string"==typeof a},isURL:function(a){a=""+a;return-1!=a.indexOf("http://")||-1!=a.indexOf("https://")}};Tr8n.Proxy.Language=function(a){this.options=a};Tr8n.Proxy.Language.prototype={getProxy:function(){return this.options.proxy},getLogger:function(){return this.getProxy().logger},translate:function(a,b,c,d){return(new Tr8n.Proxy.TranslationKey(a,b,{proxy:this.getProxy()})).translate(this,c,d)}};Tr8n.Proxy.TranslationKey=function(a,b,c){this.label=a;this.description=b;this.options=c;this.generateKey()};
Tr8n.Proxy.TranslationKey.prototype={getProxy:function(){return this.options.proxy},getLogger:function(){return this.getProxy().logger},findFirstAcceptableTranslation:function(a,b){if(null!=a.label)return this.getLogger().debug("Found a single translation: "+a.label),a;a=a.labels;if(!a)return this.getLogger().error("Translations are in a weird form..."),null;this.getLogger().debug("Found translations: "+a.length);for(var c=0;c<a.length;c++){this.getLogger().debug("Checking context rules for:"+a[c].label);
if(!a[c].context)return this.getLogger().debug("Translation has no context, using it by default"),a[c];var d=!0,g;for(g in a[c].context)if(d){var l=a[c].context[g],l=this.getProxy().getLanguageRuleForType(l.type);this.getLogger().debug("Evaluating rule: "+l);this.getProxy();l=eval("new "+l+"(token_context, options)");d=d&&l.evaluate(g,b)}if(d)return this.getLogger().debug("Found valid translation: "+a[c].label),a[c];this.getLogger().debug("The rules were not matched for: "+a[c].label)}this.getLogger().debug("No acceptable ranslations found");
return null},translate:function(a,b,c){if(!this.label)return this.getLogger().error("Label must always be provided for the translate method"),"";if(a=this.getProxy().getTranslations()[this.key]){this.getLogger().debug("Found translations, evaluating rules...");this.id=a.id;this.original=a.original;if(a=this.findFirstAcceptableTranslation(a,b))return this.getLogger().debug("Found a valid match: "+a.label),this.substituteTokens(a.label,b,c);this.getLogger().debug("No valid match found, using default language");
return this.substituteTokens(this.label,b,c)}this.getLogger().debug("Translation not found, using default language");this.getProxy().registerMissingTranslationKey(this,b,c);this.getLogger().debug("No translation found. Using default...");return this.substituteTokens(this.label,b,c)},generateKey:function(){this.key=this.label+";;;";this.description&&(this.key+=this.description);this.getLogger().debug("Preparing label signature: "+this.key);this.key=MD5(this.key);this.getLogger().debug("Label signature: "+
this.key)},registerDataTokens:function(a){this.data_tokens=[];this.data_tokens=this.data_tokens.concat(Tr8n.Proxy.DataToken.parse(a,{key:this,proxy:this.getProxy()}));this.data_tokens=this.data_tokens.concat(Tr8n.Proxy.TransformToken.parse(a,{key:this,proxy:this.getProxy()}))},registerDecorationTokens:function(a){this.decoration_tokens=[];this.decoration_tokens=this.decoration_tokens.concat(Tr8n.Proxy.DecorationToken.parse(a,{key:this,proxy:this.getProxy()}))},substituteTokens:function(a,b,c){this.registerDataTokens(a);
if(!this.data_tokens)return this.decorateLabel(a,c);for(var d=0;d<this.data_tokens.length;d++)a=this.data_tokens[d].substitute(a,b||{});this.registerDecorationTokens(a);if(!this.decoration_tokens)return a;for(d=0;d<this.decoration_tokens.length;d++)a=this.decoration_tokens[d].substitute(a,b||{});return this.decorateLabel(a,c)},decorateLabel:function(a,b){b=b||{};if(b.skip_decorations)return a;html=[];html.push("<tr8n ");this.id&&html.push(" translation_key_id='"+this.id+"' ");this.key&&html.push(" id='"+
this.key+"' ");var c=["tr8n_translatable"];this.original?c.push("tr8n_not_translated"):c.push("tr8n_translated");this.getProxy().inline_translations_enabled&&this.id&&html.push(" class='"+c.join(" ")+"'");html.push(">");html.push(a);html.push("</tr8n>");return html.join("")}};Tr8n.Proxy.Token=function(){};
Tr8n.Proxy.Token.prototype={getProxy:function(){return this.options.proxy},getLogger:function(){return this.getProxy().logger},getExpression:function(){return null},register:function(a,b){null==this.getExpression()&&alert("Token expression must be provided");var c=a.match(this.getExpression());if(!c)return[];var d=[],g={};for(i=0;i<c.length;i++)g[c[i]]||(b.proxy.debug("Registering data token: "+c[i]),d.push(new Tr8n.Proxy.TransformToken(a,c[i],b)),g[c[i]]=!0);return d},getFullName:function(){return this.full_name},
getDeclaredName:function(){this.declared_name||(this.declared_name=this.getFullName().replace(/[{}\[\]]/g,""));return this.declared_name},getName:function(){this.name||(this.name=Tr8n.Utils.trim(this.getDeclaredName().split(":")[0]));return this.name},getLanguageRule:function(){return null},substitute:function(a,b){var c=b[this.getName()];return null==c?(this.getLogger().error("Value for token: "+this.getFullName()+" was not provided"),a):Tr8n.Utils.replaceAll(a,this.getFullName(),this.getTokenValue(c))},
getTokenValue:function(a){return"string"==typeof a||"number"==typeof a?a:a.value},getTokenObject:function(a){return"string"==typeof a||"number"==typeof a?a:a.subject},getType:function(){if(-1==this.getDeclaredName().indexOf(":"))return null;this.type||(this.type=this.getDeclaredName().split("|")[0].split(":"),this.type=this.type[this.type.length-1]);return this.type},getSuffix:function(){this.suffix||(this.suffix=this.getName().split("_"),this.suffix=this.suffix[this.suffix.length-1]);return this.suffix},
getLanguageRule:function(){this.language_rule||(this.language_rule=this.getType()?this.getProxy().getLanguageRuleForType(this.getType()):this.getProxy().getLanguageRuleForTokenSuffix(this.getSuffix()));return this.language_rule}};Tr8n.Proxy.DataToken=function(a,b,c){this.label=a;this.full_name=b;this.options=c};Tr8n.Proxy.DataToken.prototype=new Tr8n.Proxy.Token;Tr8n.Proxy.DataToken.parse=function(a,b){var c=a.match(/(\{[^_][\w]+(:[\w]+)?\})/g);if(!c)return[];var d=[],g={};for(i=0;i<c.length;i++)g[c[i]]||(b.proxy.debug("Registering data token: "+c[i]),d.push(new Tr8n.Proxy.DataToken(a,c[i],b)),g[c[i]]=!0);return d};Tr8n.Proxy.TransformToken=function(a,b,c){this.label=a;this.full_name=b;this.options=c};Tr8n.Proxy.TransformToken.prototype=new Tr8n.Proxy.Token;Tr8n.Proxy.TransformToken.parse=function(a,b){var c=a.match(/(\{[^_][\w]+(:[\w]+)?\s*\|\|?[^{^}]+\})/g);if(!c)return[];var d=[],g={};for(i=0;i<c.length;i++)g[c[i]]||(b.proxy.debug("Registering transform token: "+c[i]),d.push(new Tr8n.Proxy.TransformToken(a,c[i],b)),g[c[i]]=!0);return d};
Tr8n.Proxy.TransformToken.prototype.getName=function(){this.name||(this.name=Tr8n.Utils.trim(this.getDeclaredName().split("|")[0].split(":")[0]));return this.name};Tr8n.Proxy.TransformToken.prototype.getPipedParams=function(){if(!this.piped_params){var a=this.getDeclaredName().split("|"),a=a[a.length-1].split(",");this.piped_params=[];for(i=0;i<a.length;i++)this.piped_params.push(Tr8n.Utils.trim(a[i]))}return this.piped_params};
Tr8n.Proxy.TransformToken.prototype.substitute=function(a,b){var c=b[this.getName()];if(null==c)return this.getLogger().error("Value for token: "+this.getFullName()+" was not provided"),a;var d=this.getTokenObject(c);this.getLogger().debug("Registered "+this.getPipedParams().length+" piped params");var g=this.getLanguageRule();if(g)this.getLogger().debug("Transform token uses rule: "+g);else return this.getLogger().error("Rule type cannot be determined for the transform token: "+this.getFullName()),
a;d=eval(g).transform(d,this.getPipedParams());this.getLogger().debug("Registered transform value: "+d);this.isAllowedInTranslation()&&(d=this.getTokenValue(c)+" "+d);return Tr8n.Utils.replaceAll(a,this.getFullName(),d)};Tr8n.Proxy.TransformToken.prototype.getPipedSeparator=function(){this.piped_separator||(this.piped_separator=-1!=this.getFullName().indexOf("||")?"||":"|");return this.piped_separator};Tr8n.Proxy.TransformToken.prototype.isAllowedInTranslation=function(){return"||"==this.getPipedSeparator()};Tr8n.Proxy.DecorationToken=function(a,b,c){this.label=a;this.full_name=b;this.options=c};Tr8n.Proxy.DecorationToken.prototype=new Tr8n.Proxy.Token;Tr8n.Proxy.DecorationToken.parse=function(a,b){var c=a.match(/(\[\w+:[^\]]+\])/g);if(!c)return[];var d=[],g={};for(i=0;i<c.length;i++)g[c[i]]||(b.proxy.debug("Registering decoration token: "+c[i]),d.push(new Tr8n.Proxy.DecorationToken(a,c[i],b)),g[c[i]]=!0);return d};
Tr8n.Proxy.DecorationToken.prototype.getDecoratedValue=function(){if(!this.decorated_value){var a=this.getFullName().replace(/[\]]/g,""),a=a.substring(a.indexOf(":")+1,a.length);this.decorated_value=Tr8n.Proxy.Utils.trim(a)}return this.decorated_value};
Tr8n.Proxy.DecorationToken.prototype.substitute=function(a,b){var c=b[this.getName()],d=c;if(!c||"object"==typeof c){d=this.getProxy().getDecorationFor(this.getName());if(!d)return this.getLogger().error("Default decoration is not defined for token "+this.getName()),a;d=Tr8n.Proxy.Utils.replaceAll(d,"{$0}",this.getDecoratedValue());if(c)for(var g in c)d=Tr8n.Proxy.Utils.replaceAll(d,"{$"+g+"}",c[g])}else if("string"==typeof c)d=Tr8n.Proxy.Utils.replaceAll(d,"{$0}",this.getDecoratedValue());else return this.getLogger().error("Unknown type of decoration token "+
this.getFullName()),a;return Tr8n.Proxy.Utils.replaceAll(a,this.getFullName(),d)};Tr8n.Proxy.LanguageRule=function(){};
Tr8n.Proxy.LanguageRule.prototype={getProxy:function(){return this.options.proxy},getLogger:function(){return this.getProxy().logger},getTokenValue:function(a,b){var c=b[a];null==c&&this.getLogger().error("Invalid token value for token: "+a);return c},getDefinitionDescription:function(){var a=[],b;for(b in this.definition)a.push(b+": '"+this.definition[b]+"'");return"{"+a.join(", ")+"}"},sanitizeArrayValue:function(a){for(var b=[],a=a.split(","),c=0;c<a.length;c++)b.push(Tr8n.Utils.trim(a[c]));return b}};Tr8n.Proxy.DateRule=function(a,b){this.definition=a;this.options=b};Tr8n.Proxy.DateRule.prototype=new Tr8n.Proxy.LanguageRule;Tr8n.Proxy.DateRule.transform=function(){return""};Tr8n.Proxy.DateRule.prototype.evaluate=function(){return!0};Tr8n.Proxy.GenderRule=function(a,b){this.definition=a;this.options=b};Tr8n.Proxy.GenderRule.prototype=new Tr8n.Proxy.LanguageRule;Tr8n.Proxy.GenderRule.transform=function(a,b){if(1==b.length)return b[0];if("string"==typeof a){if("male"==a)return b[0];if("female"==a)return b[1]}else if("object"==typeof a){if("male"==a.gender)return b[0];if("female"==a.gender)return b[1]}return 3==b.length?b[2]:b[0]+"/"+b[1]};
Tr8n.Proxy.GenderRule.prototype.evaluate=function(a,b){var c=this.getTokenValue(a,b);if(!c)return!1;var d="";if("object"!=typeof c)return this.getLogger().error("Invalid token value for gender based token: "+a+". Token value must be an object."),!1;if(!c.subject)return this.getLogger().error("Invalid token subject for gender based token: "+a+". Token value must contain a subject. Subject can be a string or an object with a gender."),!1;if("string"==typeof c.subject)d=c.subject;else if("object"==typeof c.subject){if(d=
c.subject.gender,!d)return this.getLogger().error("Cannot determine gender for token subject: "+a),!1}else return this.getLogger().error("Invalid token subject for gender based token: "+a+". Subject does not have a gender."),!1;return"is"==this.definition.operator?d==this.definition.value:"is_not"==this.definition.operator?d!=this.definition.value:!1};Tr8n.Proxy.NumericRule=function(a,b){this.definition=a;this.options=b};Tr8n.Proxy.NumericRule.prototype=new Tr8n.Proxy.LanguageRule;Tr8n.Proxy.NumericRule.transform=function(a,b){return 1==a?b[0]:2==b.length?b[1]:b[0].pluralize()};
Tr8n.Proxy.NumericRule.prototype.evaluate=function(a,b){var c=this.getTokenValue(a,b);if(null==c)return!1;var d=null;if("string"==typeof c||"number"==typeof c)d=""+c;else if("object"==typeof c&&c.subject)d=""+c.subject;else return this.getLogger().error("Invalid token value for numeric token: "+a),!1;this.getLogger().debug("Rule value: '"+d+"' for definition: "+this.getDefinitionDescription());c=this.evaluatePartialRule(d,this.definition.part1,this.sanitizeArrayValue(this.definition.value1));if("false"==
this.definition.multipart||!1==this.definition.multipart||null==this.definition.multipart)return c;this.getLogger().debug("Part 1: "+c+" Processing part 2...");d=this.evaluatePartialRule(d,this.definition.part2,this.sanitizeArrayValue(this.definition.value2));this.getLogger().debug("Part 2: "+d+" Completing evaluation...");return"or"==this.definition.operator?c||d:c&&d};
Tr8n.Proxy.NumericRule.prototype.evaluatePartialRule=function(a,b,c){if("is"==b)return-1!=Tr8n.Utils.indexOf(c,a)?!0:!1;if("is_not"==b)return-1==Tr8n.Utils.indexOf(c,a)?!0:!1;if("ends_in"==b){for(b=0;b<c.length;b++)if(a.match(c[b]+"$"))return!0;return!1}if("does_not_end_in"==b){for(b=0;b<c.length;b++)if(a.match(c[b]+"$"))return!1;return!0}return!1};Tr8n.Proxy.ListRule=function(a,b){this.definition=a;this.options=b};Tr8n.Proxy.ListRule.prototype=new Tr8n.Proxy.LanguageRule;Tr8n.Proxy.ListRule.transform=function(){return""};Tr8n.Proxy.ListRule.prototype.evaluate=function(){return!0};Tr8n.Proxy.GenderListRule=function(a,b){this.definition=a;this.options=b};Tr8n.Proxy.GenderListRule.prototype=new Tr8n.Proxy.LanguageRule;Tr8n.Proxy.GenderListRule.transform=function(){return""};Tr8n.Proxy.GenderListRule.prototype.evaluate=function(){return!0};Tr8n.Tml=Tr8n.Tml||{};
Tr8n.Tml.Label=function(a){this.node=a;this.description=this.label="";this.tokens={};this.options={};for(a=0;a<this.node.childNodes.length;a++){var b=this.node.childNodes[a];3==b.nodeType?this.label=this.label+" "+Tr8n.Utils.trim(b.nodeValue):"TML:TOKEN"==b.nodeName&&(b=new Tr8n.Tml.Token(b,this.tokens),this.label=Tr8n.Utils.trim(this.label)+" "+b.toTokenString())}this.description=(this.description=this.node.attributes.desc||this.node.attributes.description)?this.description.value:null;this.label=
this.label.replace(/\n/g,"");this.label=Tr8n.Utils.trim(this.label)};Tr8n.Tml.Label.prototype={translate:function(){this.node.innerHTML=tr8nProxy.translate(this.label,this.description,this.tokens,this.options)}};Tr8n.Tml=Tr8n.Tml||{};
Tr8n.Tml.Token=function(a,b){this.node=a;this.type=(this.type=this.node.attributes.type)?this.type.value:"data";this.name=(this.name=this.node.attributes.name)?this.name.value:"unknown";this.name=this.name.toLowerCase();this.context=(this.context=this.node.attributes.context)?this.context.value:null;this.content="";for(var c=0;c<this.node.childNodes.length;c++){var d=this.node.childNodes[c];if(3==d.nodeType)b[this.name]=a.attributes.context&&"gender"==a.attributes.context.nodeValue?{subject:a.attributes.value.nodeValue,
value:Tr8n.Utils.trim(d.nodeValue)}:Tr8n.Utils.trim(d.nodeValue);else{var g=d.nodeName.toLowerCase(),l=[];d.attributes.style&&l.push("style='"+d.attributes.style.nodeValue+"'");d.attributes["class"]&&l.push("class='"+d.attributes["class"].nodeValue+"'");b[this.name]="<"+g+" "+l.join(" ")+">{$0}</"+g+">";this.content="";for(g=0;g<d.childNodes.length;g++)l=d.childNodes[g],3==l.nodeType?this.content=Tr8n.Utils.trim(this.content)+" "+Tr8n.Utils.trim(l.nodeValue):"TML:TOKEN"==l.nodeName&&(l=new Tr8n.Tml.Token(l,
b),this.content=Tr8n.Utils.trim(this.content)+" "+l.toTokenString())}}this.content=this.content.replace(/\n/g,"");this.content=Tr8n.Utils.trim(this.content)};Tr8n.Tml.Token.prototype={toTokenString:function(){return"data"==this.type?"{"+this.name+"}":"["+this.name+": "+this.content+"]"}};var tr8nTranslator=null,tr8nLanguageSelector=null,tr8nLightbox=null,tr8nLanguageCaseManager=null;
function initializeTr8n(){Tr8n.Utils.addEvent(window,"load",function(){tr8nTranslator=new Tr8n.Translator;tr8nLanguageSelector=new Tr8n.LanguageSelector;tr8nLightbox=new Tr8n.Lightbox;tr8nLanguageCaseManager=new Tr8n.LanguageCaseManager;Tr8n.Utils.addEvent(document,"keyup",function(a){27==a.keyCode&&(tr8nTranslator.hide(),tr8nLanguageSelector.hide(),tr8nLightbox.hide(),tr8nLanguageCaseManager.hide())})})};
